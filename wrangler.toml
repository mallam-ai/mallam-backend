name = "mallam-backend"
main = "src/index.ts"
compatibility_date = "2023-12-01"
routes = [{ pattern = "api.mallam.ai", custom_domain = true }]

[ai]
binding = "AI"

[triggers]
crons = ["* * * * *"]

[[d1_databases]]
binding = "DB_MAIN"
database_name = "mallam-main"
database_id = "8ea16b21-7de0-4cd1-9a65-cf3d049639c0"

[[queues.producers]]
binding = "QUEUE_MAIN_DOCUMENT_ANALYSIS"
queue = "mallam-main-document-analysis"

[[queues.consumers]]
queue = "mallam-main-document-analysis"
dead_letter_queue = "mallam-main-document-analysis-failed"
max_retries = 5

[[queues.consumers]]
queue = "mallam-main-document-analysis-failed"
max_retries = 5


[[vectorize]]
binding = "VECTORIZE_DATASETS_SENTENCES"
index_name = "mallam-datasets-sentences"

[[vectorize]]
binding = "VECTORIZE_MAIN_SENTENCES"
index_name = "mallam-main-sentences"
